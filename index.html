<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Cleanup Content Calendar - Kanban View</title>
    
    <!-- Libraries untuk Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        /* Reset dan Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }
        
        /* Main Container */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f5f7fa;
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* Header Mobile */
        .header-mobile {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .header-subtitle {
            font-size: 12px;
            text-align: center;
            opacity: 0.9;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            justify-content: center;
            padding: 10px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }
        
        .view-btn {
            padding: 8px 16px;
            border: none;
            background: #f8f9fa;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .view-btn:first-child {
            border-radius: 8px 0 0 8px;
        }
        
        .view-btn:last-child {
            border-radius: 0 8px 8px 0;
        }
        
        .view-btn.active {
            background: #667eea;
            color: white;
        }
        
        /* Month Navigation */
        .month-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: white;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .month-nav-button {
            width: 36px;
            height: 36px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            touch-action: manipulation;
        }
        
        .month-nav-button:active {
            transform: scale(0.95);
        }
        
        .month-display {
            font-size: 16px;
            font-weight: bold;
            color: #2d3748;
            text-align: center;
            flex: 1;
        }
        
        /* Kanban Container */
        .kanban-container {
            flex: 1;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 10px 5px;
            padding-bottom: 100px;
            background: #f5f7fa;
        }
        
        /* Kanban Week View */
        .kanban-week {
            display: flex;
            gap: 8px;
            min-width: fit-content;
            padding: 0 5px;
        }
        
        /* Kanban Column */
        .kanban-column {
            flex: 0 0 auto;
            width: 280px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 250px);
            transition: all 0.3s;
        }
        
        .kanban-column.weekend {
            background: #fef5f5;
        }
        
        .kanban-column.today {
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
            border: 2px solid #667eea;
        }
        
        /* Kanban Column Header */
        .kanban-header {
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .kanban-column.weekend .kanban-header {
            background: linear-gradient(135deg, #f56565 0%, #ed8936 100%);
        }
        
        .kanban-column.today .kanban-header {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .kanban-day {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 4px;
        }
        
        .kanban-date {
            font-size: 12px;
            text-align: center;
            opacity: 0.9;
        }
        
        .kanban-weekday {
            font-size: 14px;
            text-align: center;
            opacity: 0.95;
            margin-top: 2px;
        }
        
        /* Task Count Badge */
        .task-count-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: white;
            color: #667eea;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Kanban Tasks Container */
        .kanban-tasks {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            -webkit-overflow-scrolling: touch;
        }
        
        .kanban-tasks::-webkit-scrollbar {
            width: 4px;
        }
        
        .kanban-tasks::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .kanban-tasks::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }
        
        /* Task Card */
        .task-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .task-card:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .task-card.cleanup {
            border-left-color: #48bb78;
            background: linear-gradient(to right, #f0fff4, white);
        }
        
        .task-card.editing {
            border-left-color: #ed8936;
            background: linear-gradient(to right, #fffaf0, white);
        }
        
        .task-card.mrf {
            border-left-color: #9f7aea;
            background: linear-gradient(to right, #faf5ff, white);
        }
        
        .task-card.other {
            border-left-color: #718096;
            background: linear-gradient(to right, #f7fafc, white);
        }
        
        /* Task Card Content */
        .task-title {
            font-size: 13px;
            color: #2d3748;
            font-weight: 500;
            margin-bottom: 6px;
            line-height: 1.4;
        }
        
        .task-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .task-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .task-badge.cleanup {
            background: #d4edda;
            color: #155724;
        }
        
        .task-badge.editing {
            background: #fff3cd;
            color: #856404;
        }
        
        .task-badge.mrf {
            background: #e7e3ff;
            color: #5a32a3;
        }
        
        .task-badge.other {
            background: #e2e8f0;
            color: #475569;
        }
        
        .task-team {
            font-size: 11px;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .task-team-icon {
            width: 16px;
            height: 16px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Empty State */
        .empty-column {
            padding: 20px;
            text-align: center;
            color: #94a3b8;
        }
        
        .empty-icon {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }
        
        .empty-text {
            font-size: 12px;
        }
        
        /* Add Task Button */
        .add-task-btn {
            margin: 8px 12px 12px;
            padding: 8px;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            background: transparent;
            color: #64748b;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .add-task-btn:hover {
            border-color: #667eea;
            color: #667eea;
            background: #f0f4ff;
        }
        
        .add-task-btn:active {
            transform: scale(0.95);
        }
        
        /* Calendar Grid View (Toggle) */
        .calendar-view {
            display: none;
            padding: 10px;
            padding-bottom: 100px;
        }
        
        .calendar-view.active {
            display: block;
        }
        
        .kanban-view {
            display: block;
        }
        
        .kanban-view.hidden {
            display: none;
        }
        
        /* Mini Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .cal-day-header {
            padding: 8px 2px;
            text-align: center;
            font-weight: bold;
            font-size: 11px;
            color: #667eea;
        }
        
        .cal-day-cell {
            aspect-ratio: 1;
            padding: 4px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .cal-day-cell:active {
            transform: scale(0.95);
        }
        
        .cal-day-cell.other-month {
            opacity: 0.3;
        }
        
        .cal-day-cell.weekend {
            background: #fef5f5;
        }
        
        .cal-day-cell.today {
            border: 2px solid #667eea;
            background: #f0f4ff;
        }
        
        .cal-day-number {
            font-size: 12px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .cal-task-dots {
            display: flex;
            gap: 2px;
            margin-top: 4px;
        }
        
        .cal-task-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #667eea;
        }
        
        /* Bottom Navigation - Floating Style */
        .bottom-nav {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 20px;
            display: flex;
            justify-content: space-around;
            padding: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 100;
            width: calc(100% - 30px);
            max-width: 400px;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            color: #718096;
            border-radius: 12px;
            position: relative;
            touch-action: manipulation;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        .nav-label {
            font-size: 10px;
            font-weight: 600;
        }
        
        /* Task Detail Modal */
        .task-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .task-modal.active {
            transform: translateY(0);
        }
        
        .task-modal-header {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }
        
        .modal-back-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            cursor: pointer;
        }
        
        .modal-title {
            flex: 1;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
        }
        
        .task-modal-body {
            padding: 15px;
        }
        
        /* Task Actions */
        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .task-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .task-action-btn.edit {
            background: #4299e1;
            color: white;
        }
        
        .task-action-btn.delete {
            background: #f56565;
            color: white;
        }
        
        .task-action-btn:active {
            transform: scale(0.95);
        }
        
        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            transition: bottom 0.3s ease;
            z-index: 1000;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            bottom: 0;
        }
        
        .menu-header {
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 15px;
            border-radius: 20px 20px 0 0;
        }
        
        .menu-handle {
            width: 40px;
            height: 4px;
            background: #cbd5e0;
            border-radius: 2px;
            margin: 10px auto;
            cursor: grab;
        }
        
        .menu-title-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .menu-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .menu-close-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: #718096;
        }
        
        .menu-content {
            padding: 15px;
        }
        
        .menu-section {
            margin-bottom: 20px;
        }
        
        .menu-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #f8f9fa;
            color: #2d3748;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .menu-button.primary {
            background: #667eea;
            color: white;
        }
        
        .menu-button.success {
            background: #48bb78;
            color: white;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 5px;
            display: block;
            font-weight: 600;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .form-button {
            width: 100%;
            padding: 12px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Loading */
        .loading-mobile {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 3000;
            display: none;
            text-align: center;
        }
        
        .loading-mobile.show {
            display: block;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 14px;
            color: #4a5568;
        }
        
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #2d3748;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 3000;
            max-width: 90%;
            text-align: center;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: #48bb78;
        }
        
        .toast.error {
            background: #f56565;
        }
        
        /* Stats Container */
        .stats-container-mobile {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat-card-mobile {
            background: white;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .stat-value-mobile {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 4px;
        }
        
        .stat-label-mobile {
            font-size: 11px;
            color: #718096;
        }
        
        /* Config Modal */
        .config-modal-mobile {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2500;
            display: none;
            padding: 20px;
        }
        
        .config-modal-mobile.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .config-content-mobile {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Responsive */
        @media screen and (max-width: 360px) {
            .kanban-column {
                width: 260px;
            }
        }
        
        @media screen and (min-width: 768px) {
            .app-container {
                max-width: 100%;
            }
            
            .kanban-column {
                width: 320px;
            }
            
            .task-title {
                font-size: 14px;
            }
            
            .bottom-nav {
                max-width: 500px;
            }
        }
        
        @media screen and (min-width: 1024px) {
            .kanban-week {
                justify-content: center;
            }
            
            .kanban-column {
                width: 350px;
                max-height: calc(100vh - 200px);
            }
        }
        
        /* Landscape Mode */
        @media screen and (orientation: landscape) and (max-height: 600px) {
            .kanban-column {
                max-height: calc(100vh - 180px);
            }
            
            .header-mobile {
                padding: 10px;
            }
            
            .header-subtitle {
                display: none;
            }
        }
        
        /* Safe area for notch */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .bottom-nav {
                bottom: calc(15px + env(safe-area-inset-bottom));
            }
            
            .kanban-container {
                padding-bottom: calc(100px + env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <div class="header-mobile">
            <div class="header-title">📸 Cleanup Calendar</div>
            <div class="header-subtitle">Kanban Board View</div>
        </div>
        
        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="view-btn active" id="kanbanViewBtn">📋 Kanban</button>
            <button class="view-btn" id="calendarViewBtn">📅 Calendar</button>
        </div>
        
        <!-- Month Navigation -->
        <div class="month-nav">
            <button class="month-nav-button" id="prevMonthBtn">◀</button>
            <div class="month-display" id="monthDisplay">Loading...</div>
            <button class="month-nav-button" id="nextMonthBtn">▶</button>
        </div>
        
        <!-- Kanban View -->
        <div class="kanban-view" id="kanbanView">
            <div class="kanban-container" id="kanbanContainer">
                <div class="kanban-week" id="kanbanWeek">
                    <!-- Kanban columns will be generated here -->
                </div>
            </div>
        </div>
        
        <!-- Calendar Grid View -->
        <div class="calendar-view" id="calendarView">
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be generated here -->
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" id="navView">
                <span class="nav-icon">📋</span>
                <span class="nav-label">View</span>
            </button>
            <button class="nav-item" id="navStats">
                <span class="nav-icon">📊</span>
                <span class="nav-label">Stats</span>
            </button>
            <button class="nav-item" id="navGenerate">
                <span class="nav-icon">🔄</span>
                <span class="nav-label">Generate</span>
            </button>
            <button class="nav-item" id="navExport">
                <span class="nav-icon">💾</span>
                <span class="nav-label">Export</span>
            </button>
            <button class="nav-item" id="navToday">
                <span class="nav-icon">📍</span>
                <span class="nav-label">Today</span>
            </button>
        </nav>
    </div>
    
    <!-- Task Detail Modal -->
    <div class="task-modal" id="taskModal">
        <div class="task-modal-header">
            <button class="modal-back-btn" id="modalBack">←</button>
            <div class="modal-title" id="modalTitle">Task Details</div>
            <div style="width: 36px;"></div>
        </div>
        <div class="task-modal-body">
            <div id="taskDetailView" style="margin-bottom: 20px;">
                <!-- Task details will be shown here -->
            </div>
            <div style="background: #f0f4ff; border-radius: 12px; padding: 15px;">
                <h3 style="font-size: 16px; margin-bottom: 12px; color: #2d3748;">Add New Task</h3>
                <div class="form-group">
                    <label class="form-label">Task Description</label>
                    <input type="text" class="form-input" id="taskInput" placeholder="Enter task...">
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="taskCategory">
                        <option value="cleanup">Cleanup</option>
                        <option value="editing">Editing</option>
                        <option value="mrf">MRF</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Team (Optional)</label>
                    <select class="form-select" id="taskTeam">
                        <option value="">Select Team</option>
                        <option value="lele">Tim Lele - Bengkong</option>
                        <option value="walrus">Tim Walrus - Tanjung Uma</option>
                        <option value="oyster">Tim Oyster - Setokok</option>
                        <option value="dugong">Tim Dugong - Moving</option>
                        <option value="jellyfish">Tim Jellyfish - Moving</option>
                    </select>
                </div>
                <button class="form-button" id="addTaskBtn">Add Task</button>
            </div>
        </div>
    </div>
    
    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="menu-header">
            <div class="menu-handle"></div>
            <div class="menu-title-wrapper">
                <div class="menu-title" id="menuTitle">Menu</div>
                <button class="menu-close-btn" id="menuCloseBtn">✕</button>
            </div>
        </div>
        <div class="menu-content" id="menuContent">
            <!-- Dynamic content -->
        </div>
    </div>
    
    <!-- Config Modal -->
    <div class="config-modal-mobile" id="configModal">
        <div class="config-content-mobile">
            <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">⚙️ Google Sheets Config</div>
            <div style="font-size: 13px; color: #718096; margin-bottom: 15px;">
                Enter your Google Apps Script Web App URL for sync
            </div>
            <div class="form-group">
                <label class="form-label">Web App URL</label>
                <input type="text" class="form-input" id="googleUrl" 
                       placeholder="https://script.google.com/macros/s/.../exec">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button style="flex: 1; padding: 10px; background: #48bb78; color: white; border: none; border-radius: 6px;" id="saveConfigBtn">Save</button>
                <button style="flex: 1; padding: 10px; background: #f8f9fa; color: #2d3748; border: none; border-radius: 6px;" id="cancelConfigBtn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Loading -->
    <div class="loading-mobile" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <script>
        // Global Variables
        let scheduleData = {};
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let currentView = 'kanban';
        let selectedDate = null;
        let googleWebAppUrl = 'https://script.google.com/macros/s/AKfycbyShSkVm3S9PjF0D8dM63wNPNqWO58-4qroYerAlARZTIQ69pAe1gDykb4EZ3LbSzVsWQ/exec';
        let currentWeekStart = null;
        
        // Teams Configuration
        const teams = {
            lele: { name: "Tim Lele", location: "Bengkong", initial: "L" },
            walrus: { name: "Tim Walrus", location: "Tanjung Uma", initial: "W" },
            oyster: { name: "Tim Oyster", location: "Setokok", initial: "O" },
            dugong: { name: "Tim Dugong", location: "Moving", initial: "D" },
            jellyfish: { name: "Tim Jellyfish", location: "Moving", initial: "J" }
        };
        
        // Initialize App
        function init() {
            loadStoredData();
            loadGoogleConfig();
            updateMonthDisplay();
            renderKanbanView();
            setupEventListeners();
        }
        
        // Load stored data
        function loadStoredData() {
            const stored = localStorage.getItem('scheduleData');
            if (stored) {
                scheduleData = JSON.parse(stored);
            }
        }
        
        // Save data
        function saveData() {
            localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
            showToast('Data saved', 'success');
        }
        
        // Load Google config
        function loadGoogleConfig() {
            const url = localStorage.getItem('googleWebAppUrl');
            if (url) {
                googleWebAppUrl = url;
                document.getElementById('googleUrl').value = url;
            }
        }
        
        // Generate date key
        function getDateKey(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }
        
        // Update month display
        function updateMonthDisplay() {
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            document.getElementById('monthDisplay').textContent = 
                `${monthNames[currentMonth]} ${currentYear}`;
        }
        
        // Render Kanban View
        function renderKanbanView() {
            const container = document.getElementById('kanbanWeek');
            container.innerHTML = '';
            
            // Get current week or first week of month
            const today = new Date();
            const firstDay = new Date(currentYear, currentMonth, 1);
            const startOfWeek = getWeekStart(today.getMonth() === currentMonth ? today : firstDay);
            currentWeekStart = startOfWeek;
            
            // Generate 7 days
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                
                const column = createKanbanColumn(date);
                container.appendChild(column);
            }
            
            // Scroll to today if in current month
            if (today.getMonth() === currentMonth && today.getFullYear() === currentYear) {
                setTimeout(() => {
                    const todayColumn = document.querySelector('.kanban-column.today');
                    if (todayColumn) {
                        todayColumn.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                    }
                }, 100);
            }
        }
        
        // Get start of week (Sunday)
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }
        
        // Create Kanban Column
        function createKanbanColumn(date) {
            const column = document.createElement('div');
            column.className = 'kanban-column';
            
            const dayOfWeek = date.getDay();
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
            const isToday = isDateToday(date);
            const isOtherMonth = date.getMonth() !== currentMonth;
            
            if (isWeekend) column.classList.add('weekend');
            if (isToday) column.classList.add('today');
            if (isOtherMonth) column.style.opacity = '0.5';
            
            // Header
            const header = document.createElement('div');
            header.className = 'kanban-header';
            header.style.position = 'relative';
            
            const dayNum = document.createElement('div');
            dayNum.className = 'kanban-day';
            dayNum.textContent = date.getDate();
            
            const weekdayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const weekday = document.createElement('div');
            weekday.className = 'kanban-weekday';
            weekday.textContent = weekdayNames[dayOfWeek];
            
            const dateStr = document.createElement('div');
            dateStr.className = 'kanban-date';
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            dateStr.textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            
            header.appendChild(dayNum);
            header.appendChild(weekday);
            header.appendChild(dateStr);
            
            // Task count badge
            const dateKey = getDateKey(date.getFullYear(), date.getMonth(), date.getDate());
            const tasks = scheduleData[dateKey] || [];
            if (tasks.length > 0) {
                const badge = document.createElement('div');
                badge.className = 'task-count-badge';
                badge.textContent = tasks.length;
                header.appendChild(badge);
            }
            
            column.appendChild(header);
            
            // Tasks container
            const tasksContainer = document.createElement('div');
            tasksContainer.className = 'kanban-tasks';
            
            if (tasks.length > 0) {
                tasks.forEach((task, index) => {
                    const card = createTaskCard(task, dateKey, index);
                    tasksContainer.appendChild(card);
                });
            } else {
                const empty = document.createElement('div');
                empty.className = 'empty-column';
                empty.innerHTML = `
                    <div class="empty-icon">📝</div>
                    <div class="empty-text">No tasks</div>
                `;
                tasksContainer.appendChild(empty);
            }
            
            column.appendChild(tasksContainer);
            
            // Add task button
            const addBtn = document.createElement('button');
            addBtn.className = 'add-task-btn';
            addBtn.innerHTML = '<span>+</span> Add Task';
            addBtn.onclick = () => openTaskModal(date.getFullYear(), date.getMonth(), date.getDate());
            column.appendChild(addBtn);
            
            return column;
        }
        
        // Create Task Card
        function createTaskCard(task, dateKey, index) {
            const card = document.createElement('div');
            card.className = `task-card ${task.category || 'other'}`;
            
            const title = document.createElement('div');
            title.className = 'task-title';
            title.textContent = task.text;
            card.appendChild(title);
            
            const meta = document.createElement('div');
            meta.className = 'task-meta';
            
            // Category badge
            const badge = document.createElement('span');
            badge.className = `task-badge ${task.category || 'other'}`;
            badge.textContent = task.category || 'other';
            meta.appendChild(badge);
            
            // Team info
            if (task.team && teams[task.team]) {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'task-team';
                
                const teamIcon = document.createElement('div');
                teamIcon.className = 'task-team-icon';
                teamIcon.textContent = teams[task.team].initial;
                teamDiv.appendChild(teamIcon);
                
                const teamName = document.createElement('span');
                teamName.textContent = teams[task.team].name;
                teamDiv.appendChild(teamName);
                
                meta.appendChild(teamDiv);
            }
            
            card.appendChild(meta);
            
            // Actions
            const actions = document.createElement('div');
            actions.className = 'task-actions';
            
            const editBtn = document.createElement('button');
            editBtn.className = 'task-action-btn edit';
            editBtn.textContent = 'Edit';
            editBtn.onclick = (e) => {
                e.stopPropagation();
                editTask(dateKey, index);
            };
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'task-action-btn delete';
            deleteBtn.textContent = 'Delete';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                deleteTask(dateKey, index);
            };
            
            actions.appendChild(editBtn);
            actions.appendChild(deleteBtn);
            card.appendChild(actions);
            
            return card;
        }
        
        // Check if date is today
        function isDateToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() &&
                   date.getMonth() === today.getMonth() &&
                   date.getFullYear() === today.getFullYear();
        }
        
        // Open Task Modal
        function openTaskModal(year, month, day) {
            selectedDate = { year, month, day };
            const modal = document.getElementById('taskModal');
            const dateKey = getDateKey(year, month, day);
            
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const date = new Date(year, month, day);
            
            document.getElementById('modalTitle').textContent = 
                `${dayNames[date.getDay()]}, ${day}/${month + 1}/${year}`;
            
            // Display existing tasks
            const detailView = document.getElementById('taskDetailView');
            detailView.innerHTML = '';
            
            if (scheduleData[dateKey] && scheduleData[dateKey].length > 0) {
                const taskList = document.createElement('div');
                taskList.style.marginBottom = '15px';
                
                scheduleData[dateKey].forEach((task, index) => {
                    const taskItem = document.createElement('div');
                    taskItem.style.cssText = 'background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 8px;';
                    
                    const taskText = document.createElement('div');
                    taskText.style.cssText = 'font-size: 14px; color: #2d3748; margin-bottom: 8px;';
                    taskText.textContent = task.text;
                    
                    const taskMeta = document.createElement('div');
                    taskMeta.style.cssText = 'display: flex; gap: 8px; align-items: center;';
                    
                    const catBadge = document.createElement('span');
                    catBadge.className = `task-badge ${task.category}`;
                    catBadge.textContent = task.category;
                    taskMeta.appendChild(catBadge);
                    
                    if (task.team) {
                        const teamSpan = document.createElement('span');
                        teamSpan.style.cssText = 'font-size: 11px; color: #64748b;';
                        teamSpan.textContent = teams[task.team].name;
                        taskMeta.appendChild(teamSpan);
                    }
                    
                    taskItem.appendChild(taskText);
                    taskItem.appendChild(taskMeta);
                    taskList.appendChild(taskItem);
                });
                
                detailView.appendChild(taskList);
            }
            
            modal.classList.add('active');
        }
        
        // Add Task
        function addTask() {
            const input = document.getElementById('taskInput');
            const category = document.getElementById('taskCategory').value;
            const team = document.getElementById('taskTeam').value;
            
            if (!input.value.trim()) {
                showToast('Please enter task', 'error');
                return;
            }
            
            if (!selectedDate) return;
            
            const dateKey = getDateKey(selectedDate.year, selectedDate.month, selectedDate.day);
            
            if (!scheduleData[dateKey]) {
                scheduleData[dateKey] = [];
            }
            
            const taskData = {
                text: input.value.trim(),
                category: category
            };
            
            if (team) {
                taskData.team = team;
            }
            
            scheduleData[dateKey].push(taskData);
            saveData();
            
            input.value = '';
            document.getElementById('taskTeam').value = '';
            
            document.getElementById('taskModal').classList.remove('active');
            renderKanbanView();
        }
        
        // Edit Task
        function editTask(dateKey, index) {
            const task = scheduleData[dateKey][index];
            const newText = prompt('Edit task:', task.text);
            
            if (newText !== null && newText.trim()) {
                scheduleData[dateKey][index].text = newText.trim();
                saveData();
                renderKanbanView();
            }
        }
        
        // Delete Task
        function deleteTask(dateKey, index) {
            if (confirm('Delete this task?')) {
                scheduleData[dateKey].splice(index, 1);
                
                if (scheduleData[dateKey].length === 0) {
                    delete scheduleData[dateKey];
                }
                
                saveData();
                renderKanbanView();
            }
        }
        
        // Toggle View
        function toggleView(view) {
            currentView = view;
            
            if (view === 'kanban') {
                document.getElementById('kanbanView').classList.remove('hidden');
                document.getElementById('calendarView').classList.remove('active');
                document.getElementById('kanbanViewBtn').classList.add('active');
                document.getElementById('calendarViewBtn').classList.remove('active');
                renderKanbanView();
            } else {
                document.getElementById('kanbanView').classList.add('hidden');
                document.getElementById('calendarView').classList.add('active');
                document.getElementById('kanbanViewBtn').classList.remove('active');
                document.getElementById('calendarViewBtn').classList.add('active');
                renderCalendarView();
            }
        }
        
        // Render Calendar View
        function renderCalendarView() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Day headers
            const dayHeaders = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'cal-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Calculate days
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const prevLastDay = new Date(currentYear, currentMonth, 0);
            
            const startDay = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            const daysInPrevMonth = prevLastDay.getDate();
            
            // Previous month days
            for (let i = startDay - 1; i >= 0; i--) {
                const cell = createCalendarCell(daysInPrevMonth - i, currentMonth - 1, currentYear, true);
                grid.appendChild(cell);
            }
            
            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = createCalendarCell(day, currentMonth, currentYear, false);
                grid.appendChild(cell);
            }
            
            // Next month days
            const totalCells = grid.children.length - 7;
            const remainingCells = 35 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const cell = createCalendarCell(day, currentMonth + 1, currentYear, true);
                grid.appendChild(cell);
            }
        }
        
        // Create Calendar Cell
        function createCalendarCell(day, month, year, isOtherMonth) {
            const cell = document.createElement('div');
            cell.className = 'cal-day-cell';
            
            if (isOtherMonth) cell.classList.add('other-month');
            
            const actualMonth = month < 0 ? 11 : month > 11 ? 0 : month;
            const actualYear = month < 0 ? year - 1 : month > 11 ? year + 1 : year;
            const date = new Date(actualYear, actualMonth, day);
            
            if (date.getDay() === 0 || date.getDay() === 6) {
                cell.classList.add('weekend');
            }
            
            if (isDateToday(date)) {
                cell.classList.add('today');
            }
            
            const dayNum = document.createElement('div');
            dayNum.className = 'cal-day-number';
            dayNum.textContent = day;
            cell.appendChild(dayNum);
            
            // Task dots
            const dateKey = getDateKey(actualYear, actualMonth, day);
            if (scheduleData[dateKey] && scheduleData[dateKey].length > 0) {
                const dots = document.createElement('div');
                dots.className = 'cal-task-dots';
                
                const numDots = Math.min(scheduleData[dateKey].length, 3);
                for (let i = 0; i < numDots; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'cal-task-dot';
                    dots.appendChild(dot);
                }
                
                cell.appendChild(dots);
            }
            
            cell.onclick = () => {
                if (!isOtherMonth) {
                    openTaskModal(actualYear, actualMonth, day);
                }
            };
            
            return cell;
        }
        
        // Navigate months
        function navigatePrevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateMonthDisplay();
            if (currentView === 'kanban') {
                renderKanbanView();
            } else {
                renderCalendarView();
            }
        }
        
        function navigateNextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateMonthDisplay();
            if (currentView === 'kanban') {
                renderKanbanView();
            } else {
                renderCalendarView();
            }
        }
        
        // Navigate to today
        function navigateToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            updateMonthDisplay();
            if (currentView === 'kanban') {
                renderKanbanView();
            } else {
                renderCalendarView();
            }
            showToast('Navigated to today', 'success');
        }
        
        // Show stats
        function showStats() {
            const menuContent = document.getElementById('menuContent');
            
            let totalTasks = 0;
            let cleanupCount = 0;
            let editingCount = 0;
            let mrfCount = 0;
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = getDateKey(currentYear, currentMonth, day);
                if (scheduleData[dateKey]) {
                    totalTasks += scheduleData[dateKey].length;
                    scheduleData[dateKey].forEach(task => {
                        if (task.category === 'cleanup') cleanupCount++;
                        if (task.category === 'editing') editingCount++;
                        if (task.category === 'mrf') mrfCount++;
                    });
                }
            }
            
            const statsHTML = `
                <div class="stats-container-mobile">
                    <div class="stat-card-mobile">
                        <div class="stat-value-mobile">${totalTasks}</div>
                        <div class="stat-label-mobile">Total Tasks</div>
                    </div>
                    <div class="stat-card-mobile">
                        <div class="stat-value-mobile">${cleanupCount}</div>
                        <div class="stat-label-mobile">Cleanup</div>
                    </div>
                    <div class="stat-card-mobile">
                        <div class="stat-value-mobile">${editingCount}</div>
                        <div class="stat-label-mobile">Editing</div>
                    </div>
                    <div class="stat-card-mobile">
                        <div class="stat-value-mobile">${mrfCount}</div>
                        <div class="stat-label-mobile">MRF</div>
                    </div>
                </div>
            `;
            
            menuContent.innerHTML = statsHTML;
            document.getElementById('menuTitle').textContent = 'Statistics';
            document.getElementById('mobileMenu').classList.add('active');
        }
        
        // Show Generate Menu
        function showGenerateMenu() {
            const menuContent = document.getElementById('menuContent');
            
            const generateHTML = `
                <div class="menu-section">
                    <button class="menu-button primary" onclick="generateMonthly()">
                        📅 Generate Monthly
                    </button>
                    <button class="menu-button primary" onclick="generateYearly()">
                        📆 Generate Yearly
                    </button>
                </div>
            `;
            
            menuContent.innerHTML = generateHTML;
            document.getElementById('menuTitle').textContent = 'Generate Schedule';
            document.getElementById('mobileMenu').classList.add('active');
        }
        
        // Generate Monthly Schedule
        function generateMonthly() {
            if (!confirm('This will replace existing schedule. Continue?')) {
                return;
            }
            
            closeMenu();
            showLoading('Generating monthly schedule...');
            
            const year = currentYear;
            const month = currentMonth;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Clear existing
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = getDateKey(year, month, day);
                delete scheduleData[dateKey];
            }
            
            // Generate new schedule
            const teamRotation = ['lele', 'walrus', 'oyster', 'dugong', 'jellyfish'];
            let teamIndex = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayOfWeek = date.getDay();
                const weekOfMonth = Math.ceil((day + new Date(year, month, 1).getDay()) / 7);
                const dateKey = getDateKey(year, month, day);
                
                if (dayOfWeek === 0 || dayOfWeek === 6) continue;
                
                scheduleData[dateKey] = [];
                
                if (dayOfWeek === 5) {
                    // Friday editing
                    scheduleData[dateKey].push(
                        { text: "Editing Day - Edit requested videos", category: "editing" },
                        { text: "Select & organize weekly best shots", category: "editing" },
                        { text: "Prepare landscape & portrait versions", category: "editing" }
                    );
                    
                    if (weekOfMonth === 1) {
                        scheduleData[dateKey].push({
                            text: "Edit plastic adventure of the month",
                            category: "editing"
                        });
                    }
                } else if (dayOfWeek === 1 || dayOfWeek === 3) {
                    // Monday/Wednesday
                    const assignedTeam = teamRotation[teamIndex % teamRotation.length];
                    teamIndex++;
                    
                    scheduleData[dateKey].push({
                        text: `Cleanup shooting - ${teams[assignedTeam].name} @ ${teams[assignedTeam].location}`,
                        category: "cleanup",
                        team: assignedTeam
                    });
                } else if (dayOfWeek === 2 || dayOfWeek === 4) {
                    // Tuesday/Thursday
                    scheduleData[dateKey].push(
                        { text: "MRF footage & documentation", category: "mrf" },
                        { text: "Thematic timelapse shooting", category: "cleanup" }
                    );
                }
            }
            
            saveData();
            if (currentView === 'kanban') {
                renderKanbanView();
            } else {
                renderCalendarView();
            }
            
            setTimeout(() => {
                hideLoading();
                showToast('Monthly schedule generated!', 'success');
            }, 500);
        }
        
        // Helper functions
        function showLoading(text = 'Processing...') {
            const loading = document.getElementById('loading');
            document.querySelector('.loading-text').textContent = text;
            loading.classList.add('show');
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }
        
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function closeMenu() {
            document.getElementById('mobileMenu').classList.remove('active');
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            // View toggle
            document.getElementById('kanbanViewBtn').addEventListener('click', () => toggleView('kanban'));
            document.getElementById('calendarViewBtn').addEventListener('click', () => toggleView('calendar'));
            
            // Navigation
            document.getElementById('prevMonthBtn').addEventListener('click', navigatePrevMonth);
            document.getElementById('nextMonthBtn').addEventListener('click', navigateNextMonth);
            
            // Bottom nav
            document.getElementById('navView').addEventListener('click', () => {
                toggleView(currentView === 'kanban' ? 'calendar' : 'kanban');
            });
            
            document.getElementById('navStats').addEventListener('click', showStats);
            document.getElementById('navGenerate').addEventListener('click', showGenerateMenu);
            
            document.getElementById('navExport').addEventListener('click', () => {
                showToast('Export feature coming soon', 'success');
            });
            
            document.getElementById('navToday').addEventListener('click', navigateToToday);
            
            // Task modal
            document.getElementById('modalBack').addEventListener('click', () => {
                document.getElementById('taskModal').classList.remove('active');
            });
            
            document.getElementById('addTaskBtn').addEventListener('click', addTask);
            
            // Menu close
            document.getElementById('menuCloseBtn').addEventListener('click', closeMenu);
        }
        
        // Make functions globally accessible
        window.generateMonthly = generateMonthly;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>